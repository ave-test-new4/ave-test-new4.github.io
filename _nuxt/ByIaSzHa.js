import{f as e,v as l,V as a,I as o,x as t,W as s,bZ as n,b_ as i,ap as u,c as d,o as r,F as c,b as v,K as m,A as p,G as b,a6 as f,D as g,i as w,w as y,b$ as x,at as h,au as k,d as B,B as S,t as _,bY as F,a as T,aL as V,s as A,J as q,E as N,af as I,a2 as C,c0 as L,c1 as $,c2 as E,c3 as G,c4 as W,c5 as j,m as M,c6 as P,c7 as R,c8 as U}from"./LNDzZpPm.js";import{u as z}from"./9dry2T_v.js";import{r as D,u as O}from"./fQpEmYRS.js";const J={key:1,class:"ml-5px"},K={class:"text-20px"},Q={class:"min-h-60px py-10px"},Y={class:"text-16px"},Z={class:"flex mt-10px"},H=e({__name:"quickSwapButton",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},styles:{default:""}},emits:["submitSwap"],setup(e,{emit:H}){const{t:X}=l(),ee=e,le=a(),ae=o(!1),oe=o(!1),te=o(""),se=t("noReminderQuickBuy",!1),{walletSwap:ne,loadingWalletSwap:ie}=z(),ue=s(),de=H;function re(e){var l;if(e.stopPropagation(),de("submitSwap"),!I())return;if(ae.value)return;if(new C(ee.quickBuyValue||0).lte(0))return void L({title:"Error",type:"error",message:X("amountMustG0")});const{row:a}=ee;te.value=X("quickBuyMsg",{a:ee.quickBuyValue,m:(null==(l=F(ee.row.chain))?void 0:l.main_name)||"",s:a.symbol||(a.target_token==a.token0_address?a.token0_symbol:a.token1_symbol)}),se.value?me():oe.value=!0}const ce=o(),ve=n();async function me(){var e;if(oe.value=!1,ue.provider&&ue.address&&!le.evmAddress)return void async function(){const e=new C(ee.quickBuyValue||0).toFixed();ne(e,ee.row)}();const{chain:l}=ee.row;ae.value=!0,await async function(e){var l,a,o,t;const s=le.getWalletAddress(e);if(!s)return;const n=null==(l=le.userInfo.addresses.find((l=>l.chain===e)))?void 0:l.balance;let i={chain:e,token:G(e),address:G(e),decimals:null==(a=F(e))?void 0:a.decimals,symbol:null==(o=F(e))?void 0:o.main_name};if(n)return void(ce.value={...i,balance:n});const u=await P({chain:e,tokens:[G(e)],walletAddress:s});i=(null==u?void 0:u[0])||{},ce.value={...i,symbol:null==(t=F(e))?void 0:t.main_name,chain:e,address:i.token||i.address,decimals:i.decimals||i.decimal}}(l);const a=ce.value,o=null==(e=new C(ee.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(o)||0)<=0?(L({title:"Error",type:"error",message:X("amountTooSmall")}),void(ae.value=!1)):new C(o||0).gt((null==a?void 0:a.balance)||0)?(L({title:"Error",type:"error",message:X("insufficientBalance")}),void(ae.value=!1)):void async function(e){var l,a,o,t,s;const{chain:n}=ee.row,i="solana"===n,{botSettings:u}=ve,d=null==(a=null==(l=null==u?void 0:u[n])?void 0:l.buy)?void 0:a.selected,r=null==(t=null==(o=null==u?void 0:u[n])?void 0:o.buy)?void 0:t[d];if(i&&(null==r?void 0:r.mev)&&!(await le.getBundleAvailable()))return void(ae.value=!1);const{gasTip1List:c,gasTip2List:v}=$(E().gasTip,"solana"),m=(null==r?void 0:r.mev)?c:v,p=(null==r?void 0:r.mev)?null==r?void 0:r.gas[0]:null==(s=null==r?void 0:r.gas)?void 0:s[1];let b={};if(i){let e=(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"0.002";(null==r?void 0:r.mev)&&new C(e).lt("0.002")&&(e="0.002"),b.priorityFee=new C(e).times(10**9).toFixed(0)}else{const e=0===Number(null==p?void 0:p.customFee)?"0":(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"3";b.gasTip=Number(new C(e).times(10**9).toFixed(0)),b.contractType=0,b.chain=n}const f=G(n),g=(null==r?void 0:r.slippage)||"9",w=le.getWalletAddress(n);if(!w)return;const y=Date.now().toString();b={...b,swapList:[{batchId:y,creatorAddress:w,inAmount:new C(e||0).times(10**ce.value.decimals||0).toFixed(0)}],inTokenAddress:f,outTokenAddress:ee.row.token||ee.row.target_token,swapType:1,isPrivate:(null==r?void 0:r.mev)||!1,slippage:"auto"!==g?Number(new C(g).times(100).toFixed(0)):900,autoSell:ve.autoSellConfig_autoSell||!1,autoSellConfig:null==ve?void 0:ve.selectedAutoSellConfig,autoGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellPriorityFee:i?b.priorityFee:b.gasTip};let x=W;i?x=R:"ton"===n&&(x=U);x(b).then((e=>function(e,l){var a;if(e){let o=setTimeout((()=>{pe.placeOrderUpdate++,ae.value=!1}),500);const t=(null==(a=null==ee?void 0:ee.row)?void 0:a.chain)||"",s=(null==e?void 0:e[0])||{},n={solana:"/botapi/swap/createSolTx",ton:"/botapi/swap/createSwapTonTx"};D({txInfo:s,chain:t,destination:(null==n?void 0:n[t])||"/botapi/swap/createSwapEvmTx",type:10});const i={[null==s?void 0:s.batchId]:null==s?void 0:s.id},u=M((()=>be.wsResult.tgbot),(e=>{var a,t,s,n,d;const r=e.batchId;if(r===l){if(o&&(clearTimeout(o),o=null),pe.placeOrderSuccess++,null==(t=null==(a=null==e?void 0:e.txList)?void 0:a[0])?void 0:t.success){L({type:"success",message:X("tradeSuccess")});const l=null==(s=null==e?void 0:e.txList)?void 0:s[0];O({...l,chain:null==e?void 0:e.chain},(null==i?void 0:i[r])||"")}else j((null==(d=null==(n=null==e?void 0:e.txList)?void 0:n[0])?void 0:d.failMessage)||"swap error");u(),ae.value=!1}}))}}(e,y))).catch((e=>{j(e||"swap error"),ae.value=!1}))}(o)}const pe=i(),be=u();return(e,l)=>{const a=S,o=b,t=V,s=N;return r(),d(c,null,[v(o,{disabled:!Number(e.quickBuyValue),loading:w(ae)||w(ie),color:e.buttonBg,class:g(["flex items-center [&&]:px-12px",e.classNames]),style:f([{"--el-button-hover-bg-color":"#12B886","--el-button-hover-text-color":"#FFF","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},e.styles]),onClick:re},{default:y((()=>[x(e.$slots,"default",h(k({loading:w(ae)||w(ie)})),(()=>{var l;return[w(ae)||w(ie)?p("",!0):(r(),m(a,{key:0,class:"mr-4px",name:"mynaui:lightning-solid"})),B(" "+_(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(r(),d("span",J,_((null==(l=("getChainInfo"in e?e.getChainInfo:w(F))(e.row.chain))?void 0:l.main_name)||""),1)):p("",!0)]}))])),_:3},8,["disabled","loading","color","class","style"]),w(oe)?(r(),m(s,{key:0,modelValue:w(oe),"onUpdate:modelValue":l[1]||(l[1]=e=>A(oe)?oe.value=e:null),title:e.$t("buy"),width:"400px","append-to":e.appendTo},{header:y((()=>[T("span",K,_(e.$t("buy")),1)])),footer:y((()=>[v(o,{type:"primary",class:"w-full",size:"large",onClick:q(me,["stop"])},{default:y((()=>[B(_(e.$t("confirm1")),1)])),_:1})])),default:y((()=>[T("div",Q,[T("div",Y,_(w(te)),1),T("div",Z,[v(t,{modelValue:w(se),"onUpdate:modelValue":l[0]||(l[0]=e=>A(se)?se.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:e.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])])),_:1},8,["modelValue","title","append-to"])):p("",!0)],64)}}});export{H as _};
