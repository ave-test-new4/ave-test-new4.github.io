import{f as e,bR as l,bT as t,e_ as a,R as i,v as r,r as o,j as n,m as s,g as c,a2 as d,N as u,K as p,o as m,w as v,a as g,d as b,t as f,i as x,D as P,ai as w,a1 as h,b as y,O as _,A as S,s as I,G as T,E as O,c0 as L,_ as N,c as k,a5 as z,B as R,H as C,nT as V,a4 as M,F as U,J as F,e$ as A,I as E,f0 as D,n as K,bW as j,q as $,C as B,bU as q,a$ as Y,nU as H,nV as W,d1 as Z}from"./LNDzZpPm.js";import{a as Q,E as X}from"./CyofXtRf.js";import"./BcS6nOuf.js";import"./CqaOUC0Y.js";import{g as G,d as J,a as ee,C as le,l as te,m as ae,n as ie,u as re,E as oe}from"./ChbAheob.js";import{S as ne}from"./D6i2W5JX.js";import{E as se,a as ce,b as de}from"./BrHgemS_.js";import{E as ue}from"./CdYdV4TG.js";import{E as pe}from"./Dl5uLHiY.js";import{E as me}from"./B_bYtbjB.js";const ve={class:"overflow-y-auto scrollbar-hide mx--16px px-16px"},ge={class:"mb-19px flex items-center gap-8px text-14px font-bold color-[--main-text]"},be={class:"flex items-center mb-10px"},fe={class:"flex-1 flex flex-col gap-4px color-[--main-text]"},xe={class:"color-[--third-text]"},Pe={class:"flex-1 flex flex-col gap-4px color-[--main-text]"},we={class:"color-[--third-text]"},he={class:"mb-24px text-12px color-[--yellow]"},ye={class:"flex items-center gap-4px cursor-pointer"},_e={class:"flex items-center gap-10px mt-8px mb-16px"},Se={class:"mt-16px flex items-center gap-4px cursor-pointer"},Ie={class:"flex items-center gap-10px mt-8px mb-16px"},Te={class:"color-[--main-text]"},Oe={class:"mt-16px mb-16px"},Le={class:"mt-53px flex items-center justify-between"},Ne={class:"color-[--third-text]"},ke={class:"mt-16px mb-40px flex items-center justify-between"},ze={class:"color-[--third-text]"},Re={class:"flex"},Ce=N(e({__name:"stopProfitLoss",props:l({row:{}},{visible:{type:Boolean},visibleModifiers:{}}),emits:["update:visible"],setup(e){const l=t(e,"visible"),N=e,k=a(),z=i(),{t:R}=r(),C=o(void 0),V=n({tpPercent:void 0,tpPercent1:void 0,slPercent:void 0,slPercent1:void 0,sizePercent:void 0}),M=n({triggerPrice:void 0,triggerPriceType:"LAST_PRICE",price:void 0,type:"TAKE_PROFIT_MARKET"}),U=n({triggerPrice:void 0,triggerPriceType:"LAST_PRICE",price:void 0,type:"STOP_MARKET"});s(l,(e=>{e&&(C.value=void 0,V.tpPercent=void 0,V.tpPercent1=void 0,V.slPercent=void 0,V.slPercent1=void 0,V.sizePercent=void 0,M.triggerPrice=void 0,U.triggerPrice=void 0,M.price=void 0,U.price=void 0)}));const F=c((()=>{var e,l;return(null==(e=N.row)?void 0:e.openSize)&&new d((null==(l=N.row)?void 0:l.openSize)||"0").gt(0)})),A=c((()=>{var e,l,t;const a=(null==(t=null==(l=null==(e=k.metadata)?void 0:e.contractList)?void 0:l.reduce)?void 0:t.call(l,((e,l)=>(e[l.contractId]=l.contractName,e)),{}))||{};return a.ALL=R("all"),a})),E=c((()=>{var e;return G((null==(e=N.row)?void 0:e.contractId)||"")})),D=c((()=>{var e;return J((null==(e=N.row)?void 0:e.contractId)||"")})),K=c((()=>{var e;return ee((null==(e=N.row)?void 0:e.contractId)||"")||1})),j=c((()=>{var e,l;return(null==(l=le.getSymbolModel((null==(e=N.row)?void 0:e.contractId)||""))?void 0:l.lastPrice)||"0"})),$=c((()=>{var e,l;return new d((null==(e=N.row)?void 0:e.openValue)||0).div((null==(l=N.row)?void 0:l.openSize)||0)})),B=c((()=>{var e;if(d(C.value||0).lte(0)||d(M.triggerPrice||0).lte(0))return"";const l=(null==(e=M.type)?void 0:e.includes("LIMIT"))?M.price:j.value;if(!l)return"";const t=d(M.triggerPrice||0).minus(l).times(C.value||0).abs().dp(2).toFixed();return d(M.triggerPrice||0).gte(l)&&F.value||d(M.triggerPrice||0).lte(l)&&!F.value?R("expectedProfitUSD",{n:t}):R("expectedLossUSD",{n:t})})),q=c((()=>{var e;if(d(C.value||0).lte(0)||d(U.triggerPrice||0).lte(0))return"";const l=(null==(e=U.type)?void 0:e.includes("LIMIT"))?U.price:j.value;if(!l)return"";const t=d(U.triggerPrice||0).minus(l).times(C.value||0).abs().dp(2).toFixed();return d(U.triggerPrice||0).lt(l)&&F.value||d(U.triggerPrice||0).gt(l)&&!F.value?R("expectedLossUSD",{n:t}):R("expectedProfitUSD",{n:t})})),Y=(e,l=0)=>{1===l?V.tpPercent1=Math.min(Math.max(e,0),200):V.tpPercent=e,F.value?M.triggerPrice=new d(e||0).div(100).div(K.value).plus(1).times($.value).dp(E.value,d.ROUND_FLOOR).toNumber():M.triggerPrice=new d(e||0).negated().div(100).div(K.value).plus(1).times($.value).dp(E.value,d.ROUND_FLOOR).toNumber()};const H=(e,l=0)=>{1===l?V.slPercent1=Math.min(Math.max(e,0),200):V.slPercent=e,F.value?U.triggerPrice=new d(e||0).negated().div(100).div(K.value).plus(1).times($.value).dp(E.value,d.ROUND_FLOOR).toNumber():U.triggerPrice=new d(e||0).div(100).div(K.value).plus(1).times($.value).dp(E.value,d.ROUND_FLOOR).toNumber()};const W=o(!1),Z=c((()=>{var e,l;return!C.value||!(M.triggerPrice||U.triggerPrice)||(null==(e=M.type)?void 0:e.includes("LIMIT"))&&!M.price||(null==(l=U.type)?void 0:l.includes("LIMIT"))&&!U.price}));function Q(){return W.value=!0,Promise.all([X(),ae()]).then((([e,t])=>{e&&t&&(l.value=!1)})).finally((()=>{W.value=!1}))}function X(){const e=N.row;if(M.triggerPrice&&d(C.value||"0").gt(0)){const l={type:M.type,size:String(C.value||"0"),triggerPrice:M.triggerPrice.toString()||"0",price:String(M.price||"0"),side:F.value?"SELL":"BUY",contractId:(null==e?void 0:e.contractId)||"",reduceOnly:!0,isPositionTpsl:!0,isSetOpenTp:!1,isSetOpenSl:!1};return te(l).then((e=>(L({type:"success",message:R("setTakeProfitOrderSuccess")}),Promise.resolve(e)))).catch((e=>(L({type:"error",message:null==e?void 0:e.message}),Promise.resolve(!1))))}return Promise.resolve(!0)}function ae(){const e=N.row;if(U.triggerPrice&&d(C.value||"0").gt(0)){const l={type:U.type,size:String(C.value||"0"),triggerPrice:U.triggerPrice.toString()||"0",price:String(U.price||"0"),side:F.value?"SELL":"BUY",contractId:(null==e?void 0:e.contractId)||"",reduceOnly:!0,isPositionTpsl:!0,isSetOpenTp:!1,isSetOpenSl:!1};return te(l).then((e=>(L({type:"success",message:R("setStopLossOrderSuccess")}),Promise.resolve(e)))).catch((e=>(L({type:"error",message:null==e?void 0:e.message}),Promise.resolve(!1))))}return Promise.resolve(!0)}return(e,t)=>{const a=ne,i=de,r=ce,o=se,n=ue,s=pe,c=me,L=T,k=O,X=u("slider-active");return m(),p(k,{modelValue:l.value,"onUpdate:modelValue":t[23]||(t[23]=e=>l.value=e),"append-to-body":"",title:x(R)("takeProfitStopLoss2"),width:"500px"},{default:v((()=>{var u,T,O,k,G,J,ee;return[g("div",ve,[g("div",ge,[b(f(x(A)[(null==(u=N.row)?void 0:u.contractId)||""])+" ",1),g("div",{class:P(("getColorClass"in e?e.getColorClass:x(w))((null==(T=N.row)?void 0:T.openValue)||"0"))},f(x(d)((null==(O=N.row)?void 0:O.openValue)||0).gt(0)?x(R)("long"):x(R)("short"))+" "+f(x(K))+"X ",3)]),g("div",be,[g("div",fe,[g("label",xe,f(x(R)("entryPrice")),1),b(" "+f(("formatNumber"in e?e.formatNumber:x(h))(x($).toString(),{limit:6,decimals:x(E)})),1)]),g("div",Pe,[g("label",we,f(x(R)("latestPrice")),1),b(" "+f(("formatNumber"in e?e.formatNumber:x(h))(x(j),{limit:20,decimals:x(E)})),1)])]),g("div",he,f(x(R)("stopTips")),1),g("div",null,[y(o,{trigger:"click"},{dropdown:v((()=>[y(r,{class:"[--el-font-size-base:12px]"},{default:v((()=>[y(i,{onClick:t[0]||(t[0]=e=>x(M).type="TAKE_PROFIT_MARKET")},{default:v((()=>[b(f(x(R)("marketStop")),1)])),_:1}),y(i,{onClick:t[1]||(t[1]=e=>x(M).type="TAKE_PROFIT_LIMIT")},{default:v((()=>[b(f(x(R)("limitStop")),1)])),_:1})])),_:1})])),default:v((()=>[g("span",ye,[g("span",null,f("TAKE_PROFIT_MARKET"===x(M).type?x(R)("marketStop"):x(R)("limitStop")),1),y(a)])])),_:1}),g("div",_e,[y(n,{modelValue:x(M).triggerPrice,"onUpdate:modelValue":t[2]||(t[2]=e=>x(M).triggerPrice=e),precision:x(E),controls:!1,align:"left",class:"flex-1",placeholder:x(R)("triggerPrice"),min:x(F)?Number(x(j)):void 0,max:x(F)?void 0:Number(x(j)),onChange:t[3]||(t[3]=e=>function(e){F.value?V.tpPercent=new d(e||0).minus($.value).div($.value).times(K.value).times(100).dp(0,d.ROUND_FLOOR).toNumber():V.tpPercent=new d(e||0).minus($.value).negated().div($.value).times(K.value).times(100).dp(0,d.ROUND_FLOOR).toNumber(),V.tpPercent1=Math.min(Math.max(V.tpPercent,0),200)}(e))},null,8,["modelValue","precision","placeholder","min","max"]),y(n,{modelValue:x(V).tpPercent,"onUpdate:modelValue":[t[4]||(t[4]=e=>x(V).tpPercent=e),t[5]||(t[5]=e=>Y(e,1))],modelModifiers:{number:!0},precision:0,controls:!1,align:"left",class:"w-100px text-12px",placeholder:x(R)("returnRate")},{suffix:v((()=>t[24]||(t[24]=[b(" % ")]))),_:1},8,["modelValue","placeholder"])]),_(y(s,{modelValue:x(V).tpPercent1,"onUpdate:modelValue":t[6]||(t[6]=e=>x(V).tpPercent1=e),min:0,max:200,step:1,marks:{0:"0%",50:"50%",100:"100%",150:"150%",200:"200%"},class:"mb-30px [&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-456px",onChange:t[7]||(t[7]=e=>Y(e))},null,8,["modelValue"]),[[X]]),"TAKE_PROFIT_LIMIT"===x(M).type?(m(),p(n,{key:0,modelValue:x(M).price,"onUpdate:modelValue":t[8]||(t[8]=e=>x(M).price=e),modelModifiers:{number:!0},controls:!1,align:"left",class:"text-12px [&&]:w-full",placeholder:x(R)("price")},null,8,["modelValue","placeholder"])):S("",!0),x(B)?(m(),p(c,{key:1,style:{"--el-alert-title-font-size":"12px","--el-alert-padding":"5px 10px",margin:"10px 0"},title:x(B),type:"success",closable:!1},null,8,["title"])):S("",!0),y(o,{trigger:"click"},{dropdown:v((()=>[y(r,{class:"[--el-font-size-base:12px]"},{default:v((()=>[y(i,{onClick:t[9]||(t[9]=e=>x(U).type="STOP_MARKET")},{default:v((()=>[b(f(x(R)("marketStop2")),1)])),_:1}),y(i,{onClick:t[10]||(t[10]=e=>x(U).type="STOP_LIMIT")},{default:v((()=>[b(f(x(R)("limitStop2")),1)])),_:1})])),_:1})])),default:v((()=>[g("span",Se,[g("span",null,f("STOP_MARKET"===x(U).type?x(R)("marketStop2"):x(R)("limitStop2")),1),y(a)])])),_:1}),g("div",Ie,[y(n,{modelValue:x(U).triggerPrice,"onUpdate:modelValue":t[11]||(t[11]=e=>x(U).triggerPrice=e),controls:!1,align:"left",class:"flex-1",placeholder:x(R)("triggerPrice"),min:x(F)?void 0:Number(x(j)),max:x(F)?Number(x(j)):void 0,onChange:t[12]||(t[12]=e=>function(e){F.value?V.slPercent=new d(e||0).minus($.value).negated().div($.value).times(K.value).times(100).dp(0,d.ROUND_FLOOR).toNumber():V.slPercent=new d(e||0).minus($.value).div($.value).times(K.value).times(100).dp(0,d.ROUND_FLOOR).toNumber(),V.slPercent1=Math.min(Math.max(V.slPercent,0),200)}(e))},null,8,["modelValue","placeholder","min","max"]),y(n,{modelValue:x(V).slPercent,"onUpdate:modelValue":[t[13]||(t[13]=e=>x(V).slPercent=e),t[14]||(t[14]=e=>H(e,1))],modelModifiers:{number:!0},controls:!1,align:"left",class:"w-100px text-12px",placeholder:x(R)("returnRate")},{prefix:v((()=>{var e;return[g("span",Te,f(x(d)((null==(e=x(V))?void 0:e.slPercent)||0).gt(0)?"-":""),1)]})),suffix:v((()=>t[25]||(t[25]=[b(" % ")]))),_:1},8,["modelValue","placeholder"])]),_(y(s,{modelValue:x(V).slPercent1,"onUpdate:modelValue":t[15]||(t[15]=e=>x(V).slPercent1=e),min:0,max:200,step:1,marks:{0:"0%",50:"50%",100:"100%",150:"150%",200:"200%"},class:"mb-30px [&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-456px",onChange:t[16]||(t[16]=e=>H(e))},null,8,["modelValue"]),[[X]]),"STOP_LIMIT"===x(U).type?(m(),p(n,{key:2,modelValue:x(U).price,"onUpdate:modelValue":t[17]||(t[17]=e=>x(U).price=e),modelModifiers:{number:!0},controls:!1,align:"left",class:"text-12px [&&]:w-full",placeholder:x(R)("price")},null,8,["modelValue","placeholder"])):S("",!0),x(q)?(m(),p(c,{key:3,style:{"--el-alert-title-font-size":"12px","--el-alert-padding":"5px 10px",margin:"10px 0"},title:x(q),type:"error",closable:!1},null,8,["title"])):S("",!0),g("div",Oe,[y(n,{modelValue:x(C),"onUpdate:modelValue":t[18]||(t[18]=e=>I(C)?C.value=e:null),modelModifiers:{number:!0},precision:x(D)<0?0:x(D),step:x(D)<0?10**-x(D):1,"step-strictly":x(D)<0,class:"[&&]:w-full",controls:!1,align:"left",placeholder:x(R)("orderQuantity"),max:Math.abs(Number((null==(k=e.row)?void 0:k.openSize)||"0")),onChange:t[19]||(t[19]=e=>function(e){var l;V.sizePercent=new d(e||0).times(100).div(new d((null==(l=N.row)?void 0:l.openSize)||"0").abs()).dp(0,d.ROUND_FLOOR).toNumber()}(e))},null,8,["modelValue","precision","step","step-strictly","placeholder","max"])]),_(y(s,{modelValue:x(V).sizePercent,"onUpdate:modelValue":t[20]||(t[20]=e=>x(V).sizePercent=e),min:0,max:100,step:1,marks:{0:"0%",25:"25%",50:"50%",75:"75%",100:"100%"},class:"[&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-456px",onChange:t[21]||(t[21]=e=>(e=>{var l,t;D.value<0?C.value=new d(e||0).div(100).times(new d((null==(l=N.row)?void 0:l.openSize)||"0").abs().times(new d(10).pow(D.value))).dp(0,d.ROUND_FLOOR).div(new d(10).pow(D.value)).toNumber():C.value=new d(e||0).div(100).times(new d((null==(t=N.row)?void 0:t.openSize)||"0").abs()).dp(D.value,d.ROUND_FLOOR).toNumber()})(e))},null,8,["modelValue"]),[[X]]),g("div",Le,[g("span",Ne,f(x(R)("positionQty")),1),g("span",null,f(Math.abs(Number((null==(G=N.row)?void 0:G.openSize)||"0")))+" "+f(x(A)[(null==(J=N.row)?void 0:J.contractId)||""].replace("USD","")),1)]),g("div",ke,[g("span",ze,f(x(R)("orderQuantity")),1),g("span",null,f(x(C)||"0.0")+" "+f(x(A)[(null==(ee=N.row)?void 0:ee.contractId)||""].replace("USD","")),1)]),g("div",Re,[y(L,{class:"h-40px flex-1 m-l-auto",color:x(z).isDark?"#333":"#F2F2F2",onClick:t[22]||(t[22]=e=>l.value=!1)},{default:v((()=>[b(f(e.$t("cancel")),1)])),_:1},8,["color"]),y(L,{type:"primary",class:"h-40px flex-1 m-l-auto",disabled:x(Z),loading:x(W),onClick:Q},{default:v((()=>[b(f(e.$t("confirm")),1)])),_:1},8,["disabled","loading"])])])])]})),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-d8be2fde"]]),Ve={key:0,class:"color-[--down-color]"},Me={key:1,class:"color-[--up-color]"},Ue={class:"mt-20px flex justify-end"},Fe=e({__name:"stopTable",props:{orderList:{},orderListModifiers:{},visible:{type:Boolean},visibleModifiers:{}},emits:l(["add"],["update:orderList","update:visible"]),setup(e,{emit:l}){const o=a(),n=i(),s=t(e,"orderList"),d=l,u=t(e,"visible"),{t:P}=r(),w={LAST_PRICE:P("latestPrice"),TAKE_PROFIT_LIMIT:P("takeProfitLimit"),LIMIT:P("limit"),MARKET:P("market"),STOP_LIMIT:P("stop_limit"),STOP_MARKET:P("stop_market"),TAKE_PROFIT_MARKET:P("takeProfitMarket")},_=c((()=>{var e,l,t;const a=(null==(t=null==(l=null==(e=o.metadata)?void 0:e.contractList)?void 0:l.reduce)?void 0:t.call(l,((e,l)=>(e[l.contractId]=l.contractName,e)),{}))||{};return a.ALL=P("all"),a})),I=async e=>{C.confirm(P("botCancelOrder"),P("cancelOrder"),{confirmButtonText:P("confirm"),cancelButtonText:P("cancel"),type:"warning"}).then((async()=>{var l,t,a,i;const r=e?[e]:(null==(t=null==(l=null==s?void 0:s.value)?void 0:l.map)?void 0:t.call(l,(e=>e.id)))||[];await V(r),M.success(P("cancelledOrderSuccessfully")),s.value=(null==(i=null==(a=s.value)?void 0:a.filter)?void 0:i.call(a,(e=>!r.includes(e.id))))||[]}))};return(e,l)=>{const t=X,a=R,i=Q,r=T,o=O;return m(),p(o,{modelValue:u.value,"onUpdate:modelValue":l[2]||(l[2]=e=>u.value=e),"append-to-body":"",title:x(P)("stopLimit"),width:"800px"},{default:v((()=>{var o;return[y(i,{data:null==(o=s.value)?void 0:o.toSorted(((e,l)=>((null==l?void 0:l.createdTime)||0)-((null==e?void 0:e.createdTime)||0))),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px",fit:""},{default:v((()=>[y(t,{width:"50",label:x(P)("No"),type:"index"},null,8,["label"]),y(t,{align:"right",label:x(P)("orderType"),prop:"orderType"},{default:v((({row:l})=>[l.type.includes("STOP")?(m(),k("span",Ve,f(e.$t("stopLoss")),1)):l.type.includes("PROFIT")?(m(),k("span",Me,f(e.$t("takeProfit")),1)):S("",!0)])),_:1},8,["label"]),y(t,{align:"right",label:x(P)("orderSize"),prop:"size"},{default:v((({row:l})=>[b(f(("formatNumber"in e?e.formatNumber:x(h))(l.size,10))+" "+f(x(_)[l.contractId].replace("USD","")),1)])),_:1},8,["label"]),y(t,{"min-width":"150",align:"right",label:x(P)("triggerPrice"),prop:"triggerPrice"},{default:v((({row:l})=>[b(f(l.triggerSign)+f(("formatNumber"in e?e.formatNumber:x(h))(l.triggerPrice,{limit:20,decimals:10}))+" "+f(w[l.triggerPriceType]),1)])),_:1},8,["label"]),y(t,{align:"right",label:x(P)("price"),prop:"price"},{default:v((({row:l})=>[b(f(l.type.includes("LIMIT")?("formatNumber"in e?e.formatNumber:x(h))(l.price,{decimals:10,limit:20}):x(P)("market")),1)])),_:1},8,["label"]),y(t,{"min-width":"150",align:"right",label:x(P)("orderTime"),prop:"createdTime"},{default:v((({row:e})=>[b(f(x(z)(Number(e.createdTime)).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1},8,["label"]),y(t,{width:100,align:"right",label:x(P)("action"),prop:"operate"},{default:v((({row:e})=>[y(a,{name:"custom:delete",class:"w-14px h-14px color-[--third-text] cursor-pointer",onClick:l=>I(e.id)},null,8,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"]),g("div",Ue,[y(r,{class:"m-l-auto [&&]:w-88px",color:x(n).isDark?"#333":"#F2F2F2",onClick:l[0]||(l[0]=e=>d("add"))},{default:v((()=>[b(f(e.$t("add")),1)])),_:1},8,["color"]),y(r,{type:"primary",class:"m-l-auto [&&]:w-88px",onClick:l[1]||(l[1]=e=>I())},{default:v((()=>[b(f(e.$t("cancelAll")),1)])),_:1})])]})),_:1},8,["modelValue","title"])}}}),Ae={class:"flex items-center font-bold h-21px mb-16px"},Ee={class:"flex items-center justify-between mb-16px"},De={class:"color-[--third-text]"},Ke={class:"color-[--main-text]"},je={class:"color-[--third-text] mb-8px"},$e={class:"color-[--third-text] justify-between mb-8px"},Be={class:"color-[--third-text] flex justify-between mt-38px mb-8px"},qe={class:"flex mt-20px text-16px"},Ye=N(e({__name:"closePosition",props:l({row:{},token:{}},{visible:{type:Boolean},visibleModifiers:{}}),emits:["update:visible"],setup(e){const l=e,a=i(),N=t(e,"visible"),{t:z}=r(),R=n({closePrice:void 0,closeSize:void 0});s(N,(e=>{e&&(R.closePrice=$.value,R.closeSize=d(j.value||"0").abs().times(new d(10).pow(E.value)).dp(0,d.ROUND_FLOOR).div(new d(10).pow(E.value)).toNumber(),C.value=100)}));const C=o(0),V=c((()=>"limit"===l.row.operation)),M=c((()=>V.value?z("limitClose"):z("marketClose"))),A=c((()=>G(l.row.contractId||""))),E=c((()=>J(l.row.contractId||""))),D=c((()=>le.getSymbolModel(l.row.contractId))),K=c((()=>ee(l.row.contractId)||"1")),j=c((()=>l.row.openSize||"0")),$=c((()=>{var e;return(null==(e=D.value)?void 0:e.lastPrice)||"0"}));const B=c((()=>{const e=l.row,t=(V.value?R.closePrice:$.value)||"0";if(!e||new d(t).isZero())return"0";return(Number(null==e?void 0:e.openSize)>=0?new d(t).times(new d((null==e?void 0:e.openSize)||0).abs()).minus(new d(e.openValue).abs()):new d(e.openValue||0).abs().minus(new d(t).times(new d(e.openSize).abs()))).dp(2,d.ROUND_FLOOR)})),q=o(!1),Y=c((()=>new d(R.closeSize||0).isZero()||V.value&&new d(R.closePrice||0).isZero()));function H(){const e=l.row;if(R.closePrice&&d(R.closeSize||"0").gt(0)){const l={type:V.value?"LIMIT":"MARKET",size:String(R.closeSize||"0"),price:String(R.closePrice||"0"),side:d((null==e?void 0:e.openSize)||"0").gte(0)?"SELL":"BUY",contractId:(null==e?void 0:e.contractId)||"",reduceOnly:!0,isPositionTpsl:!1,isSetOpenTp:!1,isSetOpenSl:!1};q.value=!0,te(l).then((e=>{L({type:"success",message:V.value?z("limitPriceClosePosition"):z("closePositionSubmitted")}),N.value=!1})).catch((e=>{L({type:"error",message:null==e?void 0:e.message})})).finally((()=>{q.value=!1}))}}return(e,t)=>{const i=ue,r=pe,o=T,n=O,s=u("slider-active");return m(),p(n,{modelValue:N.value,"onUpdate:modelValue":t[7]||(t[7]=e=>N.value=e),"append-to-body":"",title:x(M),width:"450px"},{default:v((()=>{var n;return[g("div",Ae,[b(f(l.token)+" · "+f(x(z)("all2")),1),g("span",{class:P(["ml-4px font-normal",("getColorClass"in e?e.getColorClass:x(w))(l.row.openValue)])},f(x(d)(l.row.openValue||0).gt(0)?x(z)("long"):x(z)("short"))+" · "+f(x(K))+"X ",3)]),g("div",Ee,[g("span",De,f(x(z)("latestPrice")),1),g("span",Ke,f(("formatNumber"in e?e.formatNumber:x(h))(x($),{limit:20,decimals:x(A)}))+" USD",1)]),x(V)?(m(),k(U,{key:0},[g("div",je,f(x(z)("closePrice")),1),y(i,{modelValue:x(R).closePrice,"onUpdate:modelValue":t[1]||(t[1]=e=>x(R).closePrice=e),precision:x(A),align:"left",controls:!1,min:0,class:"mb-16px w-full!"},{suffix:v((()=>[t[8]||(t[8]=g("span",{class:"color-[--third-text] mx-4px"},"|",-1)),g("span",{class:"color-[--up-color] clickable",onClick:t[0]||(t[0]=F((e=>x(R).closePrice=x($)),["stop"]))},f(x(z)("midPrice")),1)])),_:1},8,["modelValue","precision"])],64)):S("",!0),g("div",$e,f(x(z)("closeSize")),1),y(i,{modelValue:x(R).closeSize,"onUpdate:modelValue":t[2]||(t[2]=e=>x(R).closeSize=e),precision:x(E)<0?0:x(E),step:x(E)<0?10**-x(E):1,"step-strictly":x(E)<0,align:"left",controls:!1,class:"mb-12px w-full!",max:Math.abs(Number((null==(n=e.row)?void 0:n.openSize)||"0")),onChange:t[3]||(t[3]=e=>function(e){var t;C.value=new d(e||0).times(100).div(new d((null==(t=l.row)?void 0:t.openSize)||"0").abs()).dp(0,d.ROUND_FLOOR).toNumber()}(e))},null,8,["modelValue","precision","step","step-strictly","max"]),_(y(r,{modelValue:x(C),"onUpdate:modelValue":t[4]||(t[4]=e=>I(C)?C.value=e:null),min:0,max:100,step:1,marks:{0:"0%",25:"25%",50:"50%",75:"75%",100:"100%"},class:"[&&]:[--el-slider-button-size:16px] [--el-color-white:--icon-color] [&&]:[--el-slider-height:2px] [&&]:[--el-slider-button-wrapper-offset:-17px] [&&]:h-auto [&&]:[w-auto] [--el-border-color-light:var(--dialog-divider)] [&&]:[--el-slider-main-bg-color:--main-text] ml-4px [&&]:w-406px",onInput:t[5]||(t[5]=e=>(e=>{var t;R.closeSize=new d(e||0).div(100).times(new d((null==(t=l.row)?void 0:t.openSize)||"0").abs()).dp(E.value,d.ROUND_FLOOR).toNumber()})(e))},null,8,["modelValue"]),[[s]]),g("div",Be,[b(f(x(z)("estimatedPL"))+" ",1),g("span",{class:P(x(d)(x(B)).gte(0)?"color-[--up-color]":"color-[--down-color]")},f(x(B))+" USD",3)]),g("div",qe,[y(o,{class:"h-40px flex-1 m-l-auto",color:x(a).isDark?"#333":"#F2F2F2",onClick:t[6]||(t[6]=F((e=>N.value=!1),["stop"]))},{default:v((()=>[b(f(e.$t("cancel")),1)])),_:1},8,["color"]),y(o,{type:"primary",class:"h-40px flex-1 m-l-auto",disabled:x(Y),loading:x(q),onClick:F(H,["stop"])},{default:v((()=>[b(f(e.$t("confirm")),1)])),_:1},8,["disabled","loading"])])]})),_:1},8,["modelValue","title"])}}}),[["__scopeId","data-v-2e83ea72"]]),He={class:"relative min-h-400px bg-[--secondary-bg]"},We={class:"text-12px"},Ze={key:1},Qe={class:"flex items-center text-14px lh-18px color-[--main-text] gap-4px mb-4px"},Xe={key:0,class:"flex items-center gap-2px [&>span]:bg-[#3b3b3b] data-[active=on]:[&>span:nth-child(1)]:bg-[#08BA4E] data-[active=on]:[&>span:nth-child(2)]:bg-[#409F4B] data-[active=on]:[&>span:nth-child(3)]:bg-[#7F8147] data-[active=on]:[&>span:nth-child(4)]:bg-[#B36844] data-[active=on]:[&>span:nth-child(5)]:bg-[#F1493F]"},Ge=["data-active"],Je={class:"text-12px lh-18px flex flex-col gap-4px"},el={__name:"holding",props:{searchParams:{type:Object,default:()=>({})}},setup(e){const l=e;let t={id:null};const{t:i}=r(),n=a(),O=A(),L=E({}),N=o(!1),z=o(null),R=o(!1),C=o(!1),V=c((()=>{var e,l,t;const a=(null==(t=null==(l=null==(e=n.metadata)?void 0:e.contractList)?void 0:l.reduce)?void 0:t.call(l,((e,l)=>(e[l.contractId]=l.contractName,e)),{}))||{};return a.ALL=i("all"),a})),M=c((()=>{var e;return(null==(e=n.position)?void 0:e.filter((e=>{var t,a,i;return(null==(t=null==l?void 0:l.searchParams)?void 0:t.filterContractIdList)&&e.contractId===(null==(a=null==l?void 0:l.searchParams)?void 0:a.filterContractIdList)||!(null==(i=l.searchParams)?void 0:i.filterContractIdList)})))||[]}));s((()=>O.wsResult[D.TICKER_ALL_1S]),(e=>{n.position.forEach((l=>{var t,a,i;const r=null==(a=null==(t=e.data)?void 0:t.find)?void 0:a.call(t,(e=>e.contractId===l.contractId));if(r){l.oraclePrice=r.oraclePrice;const e=(null==r?void 0:r.lastPrice)||(null==r?void 0:r.oraclePrice)||"0",t=Number(null==l?void 0:l.openSize)>=0?new d(e).times(new d((null==l?void 0:l.openSize)||0).abs()).minus(new d(l.openValue).abs()):new d(l.openValue||0).abs().minus(new d(e).times(new d(l.openSize).abs()));l.unrealizedPnl=t.dp(2,d.ROUND_FLOOR).toString(),l.unrealizedPnlRate=null==(i=ae(l.contractId))?void 0:i.unrealizedPnlRoe}}))})),s((()=>{var e;return null==(e=n.totalAssets)?void 0:e.accountList}),(e=>{var l;if(e){const t=(null==(l=null==e?void 0:e[0])?void 0:l.positionAssetList)||[];n.position.forEach((e=>{const l=t.find((l=>l.contractId===e.contractId));l&&(e.maxLeverage=l.maxLeverage,e.liquidatePrice=l.liquidatePrice)}))}}),{immediate:!0});const F=async()=>{const e=await H();L.value=(null==e?void 0:e.positionContractIdToLightNumberMap)||{}},W=c((()=>{var e,l,t,a,i;return(null==(e=z.value)?void 0:e.contractId)?null==(i=null==(a=(null==(t=null==(l=n.order)?void 0:l.filter)?void 0:t.call(l,(e=>{var l;return e.contractId===(null==(l=z.value)?void 0:l.contractId)&&["TAKE_PROFIT_LIMIT","STOP_LIMIT","TAKE_PROFIT_MARKET","STOP_MARKET"].includes(e.type)})))||[])?void 0:a.toSorted)?void 0:i.call(a,((e,l)=>l.createdTime-e.createdTime)):[]})),Z=(e,l)=>{C.value=!0,z.value={...e,operation:l}},J=()=>{R.value=!1,N.value=!0};return K((()=>{O.send({type:"unsubscribe",channel:"ticker.all.1s"}),setTimeout((()=>{O.send({type:"subscribe",channel:"ticker.all.1s"})}),500),F(),t=j(5e3,(()=>{F()}))})),$((()=>{t.id&&cancelAnimationFrame(t.id)})),(e,l)=>{var t;const a=Y,r=X,o=T,s=Q,c=u("tooltip");return m(),k(U,null,[g("div",He,[y(s,{fit:"",data:x(M),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px"},{empty:v((()=>{var l;return[0===(null==(l=x(n).position)?void 0:l.length)?(m(),p(a,{key:0,class:"pt-[40px]"},{default:v((()=>[g("span",We,f(e.$t("emptyNoData")),1)])),_:1})):(m(),k("span",Ze))]})),default:v((()=>[y(r,{label:x(i)("markets1"),prop:"perp"},{default:v((({row:l})=>[g("div",Qe,[b(f(x(V)[l.contractId])+" ",1),"number"==typeof x(L)[l.contractId]?_((m(),k("div",Xe,[(m(),k(U,null,B(5,(e=>g("span",{key:e,class:"w-2px h-10px","data-active":x(L)[l.contractId]>e?"on":"off"},null,8,Ge))),64))])),[[c,x(i)("autoDeleverageTips")]]):S("",!0)]),g("div",{class:P(["text-10px lh-14px",("getColorClass"in e?e.getColorClass:x(w))(l.openValue)])},f(l.openValue>0?x(i)("long"):x(i)("short"))+" "+f(x(ee)(l.contractId)||l.maxLeverage)+"x ",3)])),_:1},8,["label"]),y(r,{width:100,label:x(i)("Qty"),prop:"openSize"},{default:v((({row:l})=>[b(f(("formatNumber"in e?e.formatNumber:x(h))(l.openSize.replace("-",""))),1)])),_:1},8,["label"]),y(r,{align:"right",label:x(i)("contractValue"),prop:"openValue"},{default:v((({row:l})=>[b(f(("formatNumber"in e?e.formatNumber:x(h))(l.oraclePrice?new(x(d))(l.openSize).multipliedBy(l.oraclePrice).toString().replace("-",""):l.openValue.replace("-",""),{limit:20,decimals:4})),1)])),_:1},8,["label"]),y(r,{align:"right",label:x(i)("entryPrice"),prop:"entryPrice"},{default:v((({row:l})=>[b(f(("formatNumber"in e?e.formatNumber:x(h))(new(x(d))(l.openValue).div(l.openSize).toString(),{limit:20,decimals:("getPricePrecision"in e?e.getPricePrecision:x(G))(l.contractId),decimalsHasZero:!0})),1)])),_:1},8,["label"]),y(r,{align:"right",label:x(i)("oraclePrice"),prop:"oraclePrice"},{default:v((({row:l})=>[b(f(("formatNumber"in e?e.formatNumber:x(h))(l.oraclePrice,{limit:20,decimals:("getPricePrecision"in e?e.getPricePrecision:x(G))(l.contractId),decimalsHasZero:!0})),1)])),_:1},8,["label"]),y(r,{align:"right",label:x(i)("estimatedLiquidationPrice"),prop:"liquidatePrice"},{default:v((({row:l})=>[b(f(("formatNumber"in e?e.formatNumber:x(h))(("getPositionLiqPrice"in e?e.getPositionLiqPrice:x(ie))(l.contractId)||l.liquidatePrice,{limit:20,decimals:("getPricePrecision"in e?e.getPricePrecision:x(G))(l.contractId),decimalsHasZero:!0})),1)])),_:1},8,["label"]),y(r,{align:"right",label:x(i)("unrealizedPnl"),prop:"unrealizedPnl"},{default:v((({row:l})=>[g("div",Je,[g("span",{class:P(("getColorClass"in e?e.getColorClass:x(w))(l.unrealizedPnl))},f(("addSign"in e?e.addSign:x(q))(l.unrealizedPnl))+f(("formatNumber"in e?e.formatNumber:x(h))(Math.abs(l.unrealizedPnl),2)),3),g("span",{class:P(("getColorClass"in e?e.getColorClass:x(w))(l.unrealizedPnlRate))},"("+f(("addSign"in e?e.addSign:x(q))(l.unrealizedPnlRate))+f(("formatNumber"in e?e.formatNumber:x(h))(Math.abs(l.unrealizedPnlRate),2))+"%)",3)])])),_:1},8,["label"]),y(r,{align:"right",label:x(i)("fundingFee"),prop:"fundingFee"},{default:v((({row:l})=>[b(f(("formatNumber"in e?e.formatNumber:x(h))(l.fundingFee,("getPricePrecision"in e?e.getPricePrecision:x(G))(l.contractId))),1)])),_:1},8,["label"]),y(r,{width:150,align:"right",label:x(i)("takeProfitStopLoss"),prop:"takeProfitStopLoss"},{default:v((({row:l})=>{var t,a;return[(null==(a=null==(t=x(n).order)?void 0:t.some)?void 0:a.call(t,(e=>(null==e?void 0:e.contractId)===(null==l?void 0:l.contractId))))?(m(),p(o,{key:0,size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>(e=>{z.value=e,R.value=!0})(l)},{default:v((()=>[b(f(e.$t("detail")),1)])),_:2},1032,["onClick"])):S("",!0),y(o,{size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>(e=>{z.value=e,N.value=!0})(l)},{default:v((()=>[b(" + "+f(e.$t("add")),1)])),_:2},1032,["onClick"])]})),_:1},8,["label"]),y(r,{width:150,align:"right",label:x(i)("action"),prop:"closePosition"},{default:v((({row:l})=>[y(o,{size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>Z(l,"limit")},{default:v((()=>[b(f(e.$t("limit")),1)])),_:2},1032,["onClick"]),y(o,{size:"small",style:{"--el-button-active-border-color":"transparent"},onClick:e=>Z(l,"market")},{default:v((()=>[b(f(e.$t("market")),1)])),_:2},1032,["onClick"])])),_:1},8,["label"])])),_:1},8,["data"])]),y(Ce,{visible:x(N),"onUpdate:visible":l[0]||(l[0]=e=>I(N)?N.value=e:null),row:x(z)},null,8,["visible","row"]),y(Fe,{visible:x(R),"onUpdate:visible":l[1]||(l[1]=e=>I(R)?R.value=e:null),orderList:x(W),onAdd:J},null,8,["visible","orderList"]),y(Ye,{visible:x(C),"onUpdate:visible":l[2]||(l[2]=e=>I(C)?C.value=e:null),token:x(V)[null==(t=x(z))?void 0:t.contractId]||"",row:x(z)||{}},null,8,["visible","token","row"])],64)}}},ll={class:"flex items-center justify-center w-[calc(100vw-100px)]"},tl={class:"text-12px mr-10px"},al=e({__name:"withdrawAlert",setup(e){const l=a(),{t:t}=r(),{isCanNormalWithdrawableAmount:i}=re();function n(){W().then((e=>{l.normalWithdrawableAmount=(null==e?void 0:e.amount)||"0"})).catch((e=>{l.normalWithdrawableAmount="0"}))}const s=o(!1);function c(){s.value=!0,oe().then((e=>e.wait())).then((e=>{n(),L({type:"success",message:t("claimedSuccess")})})).catch((e=>{Z(e)})).finally((()=>{s.value=!1}))}return K((()=>{n()})),(e,t)=>{const a=T,r=me;return x(i)?(m(),p(r,{key:0,type:"success",closable:!1,style:{"--el-alert-icon-large-size":"20px"}},{default:v((()=>[g("div",ll,[g("span",tl,f(e.$t("canPerpWithdraw",{n:("formatNumber"in e?e.formatNumber:x(h))(x(l).normalWithdrawableAmount,3)})),1),y(a,{type:"primary",size:"small",loading:x(s),onClick:c},{default:v((()=>[b(f(e.$t("claim")),1)])),_:1},8,["loading"])])])),_:1})):S("",!0)}}});export{el as _,al as a};
