import{f as e,v as l,V as a,I as o,x as t,bZ as s,W as n,b_ as i,ap as u,c as r,K as d,o as c,F as v,b as m,A as p,G as b,J as y,a6 as f,D as g,i as w,w as x,d as k,B as h,t as B,bY as T,E as V,s as _,a as S,aL as F,O as A,aM as q,af as N,a2 as C,a4 as I,c0 as z,c1 as L,c2 as E,c3 as $,c4 as j,c5 as G,m as M,c6 as W,c7 as O,c8 as R}from"./LNDzZpPm.js";import{u as U}from"./9dry2T_v.js";import{r as D,u as P}from"./fQpEmYRS.js";const J={key:1,class:"ml-5px"},K={class:"text-20px"},Q={class:"min-h-60px py-10px"},Y={class:"text-16px"},Z={class:"flex mt-10px"},H={key:0,class:"ml-5px"},X=e({__name:"quickSwap",props:{quickBuyValue:{},row:{},appendTo:{default:"#__nuxt"},buttonBg:{default:"rgba(18, 184, 134, 0.15)"},mainNameVisible:{type:Boolean},classNames:{default:""},size:{default:"14px"},buttonType:{default:0}},emits:["submitSwap","jump"],setup(e,{emit:X}){const{walletSwap:ee,loadingWalletSwap:le}=U(),{t:ae}=l(),oe=e,te=a(),se=o(!1),ne=o(!1),ie=o(""),ue=t("noReminderQuickBuy",!1),re=X;function de(){var e;if(re("submitSwap"),!N())return;if(se.value)return;if(1===oe.buttonType&&new C(oe.quickBuyValue||0).lte(0))return void I({type:"error",plain:!0,message:ae("buyAmountMustG0"),duration:1e3});if(new C(oe.quickBuyValue||0).lte(0))return void z({title:"Error",type:"error",message:ae("amountMustG0")});const{row:l}=oe;ie.value=ae("quickBuyMsg",{a:oe.quickBuyValue,m:(null==(e=T(oe.row.chain))?void 0:e.main_name)||"",s:l.symbol||(l.target_token==l.token0_address?l.token0_symbol:l.token1_symbol)}),ue.value||1===oe.buttonType?pe():ne.value=!0}const ce=o(),ve=s(),me=n();async function pe(){var e;if(me.provider&&me.address&&!te.evmAddress)return void async function(){const e=new C(oe.quickBuyValue||0).toFixed();ee(e,oe.row)}();ne.value=!1;const{chain:l}=oe.row;se.value=!0,await async function(e){var l,a,o,t;const s=te.getWalletAddress(e);if(!s)return;const n=null==(l=te.userInfo.addresses.find((l=>l.chain===e)))?void 0:l.balance;let i={chain:e,token:$(e),address:$(e),decimals:null==(a=T(e))?void 0:a.decimals,symbol:null==(o=T(e))?void 0:o.main_name};if(n)return void(ce.value={...i,balance:n});const u=await W({chain:e,tokens:[$(e)],walletAddress:s});i=(null==u?void 0:u[0])||{},ce.value={...i,symbol:null==(t=T(e))?void 0:t.main_name,chain:e,address:i.token||i.address,decimals:i.decimals||i.decimal}}(l);const a=ce.value,o=null==(e=new C(oe.quickBuyValue||0).toFixed().match(new RegExp(`[0-9]*(\\.[0-9]{0,${(null==a?void 0:a.decimals)||18}})?`)))?void 0:e[0];return(Number(o)||0)<=0?(z({title:"Error",type:"error",message:ae("amountTooSmall")}),void(se.value=!1)):new C(o||0).gt((null==a?void 0:a.balance)||0)?(z({title:"Error",type:"error",message:ae("insufficientBalance")}),void(se.value=!1)):void async function(e){var l,a,o,t,s;const{chain:n}=oe.row,i="solana"===n,{botSettings:u}=ve,r=null==(a=null==(l=null==u?void 0:u[n])?void 0:l.buy)?void 0:a.selected,d=null==(t=null==(o=null==u?void 0:u[n])?void 0:o.buy)?void 0:t[r],{gasTip1List:c,gasTip2List:v}=L(E().gasTip,n),m=(null==d?void 0:d.mev)?c:v,p=(null==d?void 0:d.mev)?null==d?void 0:d.gas[0]:null==(s=null==d?void 0:d.gas)?void 0:s[1];let b={};if(i){let e=(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"0.002";(null==d?void 0:d.mev)&&new C(e).lt("0.002")&&(e="0.002"),b.priorityFee=new C(e).times(10**9).toFixed(0)}else if("ton"!==n){const e=0===Number(null==p?void 0:p.customFee)?"0":(null==p?void 0:p.customFee)||(null==m?void 0:m[null==p?void 0:p.level])||"3";b.gasTip=Number(new C(e).times(10**9).toFixed(0)),b.contractType=0,b.chain=n}const y=$(n),f=(null==d?void 0:d.slippage)||"9",g=te.getWalletAddress(n);if(!g)return;const w=Date.now().toString();b={...b,swapList:[{batchId:w,creatorAddress:g,inAmount:new C(e||0).times(10**ce.value.decimals||0).toFixed(0)}],inTokenAddress:y,outTokenAddress:oe.row.token||oe.row.target_token,swapType:1,isPrivate:(null==d?void 0:d.mev)||!1,slippage:"auto"!==f?Number(new C(f).times(100).toFixed(0)):900,autoSell:ve.autoSellConfig_autoSell||!1,autoSellConfig:null==ve?void 0:ve.selectedAutoSellConfig,autoGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellGas:(null==p?void 0:p.customFee)?0:((null==p?void 0:p.level)||0)+1,autoSellPriorityFee:i?b.priorityFee:b.gasTip};let x=j;i?x=O:"ton"===n&&(x=R);x(b).then((e=>function(e,l){if(e){let a=setTimeout((()=>{be.placeOrderUpdate++,se.value=!1}),500);const o=oe.row.chain,t=(null==e?void 0:e[0])||{},s={solana:"/botapi/swap/createSolTx",ton:"/botapi/swap/createSwapTonTx"};D({txInfo:t,chain:o,destination:(null==s?void 0:s[o])||"/botapi/swap/createSwapEvmTx",type:10});const n={[null==t?void 0:t.batchId]:null==t?void 0:t.id},i=M((()=>ye.wsResult.tgbot),(e=>{var o,t,s,u,r;const d=e.batchId;if(d===l){if(a&&(clearTimeout(a),a=null),be.placeOrderSuccess++,null==(t=null==(o=null==e?void 0:e.txList)?void 0:o[0])?void 0:t.success){z({type:"success",message:ae("tradeSuccess")}),re("jump");const l=null==(s=null==e?void 0:e.txList)?void 0:s[0];P({...l,chain:null==e?void 0:e.chain},(null==n?void 0:n[d])||"")}else G((null==(r=null==(u=null==e?void 0:e.txList)?void 0:u[0])?void 0:r.failMessage)||"swap error");i(),se.value=!1}}))}}(e,w))).catch((e=>{G(e||"swap error"),se.value=!1}))}(o)}const be=i(),ye=u();return(e,l)=>{const a=h,o=b,t=F,s=V;return 0===e.buttonType?(c(),r(v,{key:0},[m(o,{disabled:!Number(e.quickBuyValue),loading:w(se)||w(le),color:e.buttonBg,class:g(["flex items-center [&&]:px-8px [&&]:py-5px [&&]:h-auto",e.classNames]),style:f([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:y(de,["stop","prevent"])},{default:x((()=>{var l;return[w(se)||w(le)?p("",!0):(c(),d(a,{key:0,style:f({"font-size":e.size}),class:"mr-4px",name:"mynaui:lightning-solid"},null,8,["style"])),k(" "+B(e.quickBuyValue||0)+" ",1),e.mainNameVisible?(c(),r("span",J,B((null==(l=("getChainInfo"in e?e.getChainInfo:w(T))(e.row.chain))?void 0:l.main_name)||""),1)):p("",!0)]})),_:1},8,["disabled","loading","color","class","style"]),w(ne)?(c(),d(s,{key:0,modelValue:w(ne),"onUpdate:modelValue":l[1]||(l[1]=e=>_(ne)?ne.value=e:null),title:e.$t("buy"),width:"400px","append-to":e.appendTo},{header:x((()=>[S("span",K,B(e.$t("buy")),1)])),footer:x((()=>[m(o,{type:"primary",class:"w-full",size:"large",onClick:y(pe,["stop"])},{default:x((()=>[k(B(e.$t("confirm1")),1)])),_:1})])),default:x((()=>[S("div",Q,[S("div",Y,B(w(ie)),1),S("div",Z,[m(t,{modelValue:w(ue),"onUpdate:modelValue":l[0]||(l[0]=e=>_(ue)?ue.value=e:null),class:"[&&]:[--el-checkbox-text-color:--d-999-l-666]",label:e.$t("noAlert"),size:"large"},null,8,["modelValue","label"])])])])),_:1},8,["modelValue","title","append-to"])):p("",!0)],64)):(c(),d(o,{key:1,loading:w(se)||w(le),color:e.buttonBg,class:g(["flex items-center [&&]:px-4px",e.classNames]),style:f([{"--el-button-hover-bg-color":"rgba(18, 184, 134, 0.3)","--el-color-black":"#12B886","--el-button-border-color":"transparent","--el-button-hover-border-color":"transparent","--el-button-disabled-text-color":"#12B886","--el-button-disabled-border-color":"transparent","--el-button-disabled-bg-color":"#12B8861A"},{"font-size":e.size}]),onClick:y(de,["stop","prevent"])},{default:x((()=>{var l;return[A(m(a,{class:"mr-4px text-12px",name:"mynaui:lightning-solid"},null,512),[[q,!w(se)]]),k(" "+B(Number(e.quickBuyValue)?e.quickBuyValue||0:e.$t("buy"))+" ",1),e.mainNameVisible&&Number(e.quickBuyValue)?(c(),r("span",H,B((null==(l=("getChainInfo"in e?e.getChainInfo:w(T))(e.row.chain))?void 0:l.main_name)||""),1)):p("",!0)]})),_:1},8,["loading","color","class","style"]))}}});export{X as _};
