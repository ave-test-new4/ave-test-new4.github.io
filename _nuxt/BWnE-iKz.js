import{f as a,W as e,v as l,e_ as t,I as r,r as i,g as s,m as o,O as n,e3 as u,c,o as d,b as m,a as p,w as f,i as g,t as b,D as v,ai as h,d as C,a1 as x,F as y,mg as w,a5 as S,K as N,a$ as _,A as z,a2 as I,q5 as O}from"./LNDzZpPm.js";import{E as D,a as V}from"./CyofXtRf.js";import"./BcS6nOuf.js";import"./CqaOUC0Y.js";import"./DuC4p7MX.js";const M=["infinite-scroll-disabled"],P={class:"text-12px"},Y={key:1},k={class:"text-14px"},B={class:"mt-[2px] mb-[5px] py-[10px] text-[12px] text-center color-[--third-text]"},L={key:0},T=a({__name:"positionHistory",props:{searchParams:{}},setup(a){const T=e(),j=a,{t:H}=l(),A=t(),U=r([]),$=i({loading:!1,finished:!1,error:!1}),q=i(""),E=s((()=>{var a,e,l;const t=(null==(l=null==(e=null==(a=A.metadata)?void 0:a.contractList)?void 0:e.reduce)?void 0:l.call(e,((a,e)=>(a[e.contractId]=e.contractName,a)),{}))||{};return t.ALL=H("all"),t})),F=a=>Math.abs(a.cumOpenSize)!==Math.abs(a.cumCloseSize),K=a=>{var e;const l=(null==(e=A.position.find((e=>e.contractId===a.contractId)))?void 0:e.openValue)||0,t=new I(0).minus(a.cumOpenValue).minus(a.cumCloseValue);return F(a)?t.plus(l):t},Q=a=>{var e;const l=K(a);if(!a.currentLeverage)return new I(0);{const t=(null==(e=A.position.find((e=>e.contractId===a.contractId)))?void 0:e.openValue)||0,r=F(a)?new I(a.cumOpenValue).abs().minus(new I(t).abs()):new I(a.cumOpenValue).abs();return r.isZero()?new I(0):l.dividedBy(r).multipliedBy(100).multipliedBy(a.currentLeverage)}},W=async()=>{var a,e;if($.value.loading||$.value.finished)return;const l={...j.searchParams};q.value&&(l.offsetData=q.value);try{$.value.loading=!0;const t=await O(l);let r=(null==(e=null==(a=t.dataList)?void 0:a.filter)?void 0:e.call(a,(a=>Math.abs(a.cumCloseSize)>0)))||[];q.value&&(r=U.value.concat(r)),t.nextPageOffsetData||($.value.finished=!0),q.value=t.nextPageOffsetData,U.value=r}catch(t){$.value.error=!0}finally{$.value.loading=!1}};T.address&&W();const Z=a=>{var e,l;const t=(null==(l=null==(e=A.contractList)?void 0:e.find((e=>e.contractId===a.contractId)))?void 0:l.oraclePrice)||0;return I(a.openSize).multipliedBy(t).minus(a.openValue).toString()},G=a=>{const e=Z(a);return I(e).dividedBy(I(a.openValue).abs()).multipliedBy(100).multipliedBy(a.leverage).toString()};return o((()=>[j.searchParams,T.address]),(()=>{q.value="",U.value=[],$.value.finished=!1,$.value.error=!1,$.value.loading=!1,W()})),(a,e)=>{const l=_,t=D,r=V,i=u;return n((d(),c("div",{class:"relative min-h-400px bg-[--secondary-bg]","infinite-scroll-delay":200,"infinite-scroll-disabled":g($).loading||g($).finished||g($).error,"infinite-scroll-immediate":!1,"infinite-scroll-distance":300},[m(r,{fit:"",data:g(U),"header-row-class-name":"text-12px sticky top-0 z-10 font-500","cell-class-name":"color-[--main-text] text-12px"},{empty:f((()=>{var e;return[g($).loading||0!==(null==(e=g(U))?void 0:e.length)?(d(),c("span",Y)):(d(),N(l,{key:0,class:"pt-[40px]"},{default:f((()=>[p("span",P,b(a.$t("emptyNoData")),1)])),_:1}))]})),default:f((()=>[m(t,{label:g(H)("markets1"),prop:"contractId"},{default:f((({row:e})=>[p("span",k,b(g(E)[e.contractId]),1),p("div",{class:v(["text-10px lh-14px",("getColorClass"in a?a.getColorClass:g(h))(e.cumOpenSize)])},b(e.cumOpenSize>0?g(H)("long"):g(H)("short")),3)])),_:1},8,["label"]),m(t,{label:g(H)("Qty"),prop:"contractSize"},{default:f((({row:e})=>[C(b(Math.abs(+("formatNumber"in a?a.formatNumber:g(x))(e.cumOpenSize)||0))+" "+b(g(E)[e.contractId].replace("USD","")),1)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("closeSize")},{default:f((({row:e})=>[C(b(Math.abs(+("formatNumber"in a?a.formatNumber:g(x))(e.cumCloseSize)||0))+" "+b(g(E)[e.contractId].replace("USD","")),1)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("status")},{default:f((({row:a})=>[C(b(F(a)?g(H)("partialClose"):g(H)("closed")),1)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("openAvgPrice")},{default:f((({row:e})=>[C(b(("formatNumber"in a?a.formatNumber:g(x))(e.cumOpenValue/e.cumOpenSize,{limit:20,decimals:2})),1)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("avgPrice2")},{default:f((({row:e})=>[C(b(("formatNumber"in a?a.formatNumber:g(x))(e.cumCloseValue/e.cumCloseSize,{limit:20,decimals:2})),1)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("unrealizedPnl")},{default:f((({row:e})=>[F(e)?(d(),c(y,{key:0},[p("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:g(h))(Z(e))])},b(("formatNumber"in a?a.formatNumber:g(x))(Z(e),2)),3),p("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:g(h))(G(e))])},b(("formatNumber"in a?a.formatNumber:g(x))(G(e),{limit:20,decimals:2}))+"% ",3)],64)):(d(),c(y,{key:1},[C("--")],64))])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("pnl")},{default:f((({row:e})=>[p("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:g(h))(K(e).toString())])},b(("formatNumber"in a?a.formatNumber:g(x))(K(e).toString())),3),p("div",{class:v(["lh-18px",("getColorClass"in a?a.getColorClass:g(h))(Q(e).toString())])},b(("formatNumber"in a?a.formatNumber:g(x))(Q(e).toString(),{limit:20,decimals:2}))+"% ",3)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("termCount")},{default:f((({row:e})=>[C(b(F(e)?"--":("formatCountdown"in a?a.formatCountdown:g(w))(0,!1,g(S)(+e.updatedTime).diff(g(S)(+e.createdTime),"s"))),1)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("openTime2")},{default:f((({row:a})=>[C(b(g(S)(+a.createdTime).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1},8,["label"]),m(t,{align:"right",label:g(H)("lastCloseTime")},{default:f((({row:a})=>[C(b(g(S)(+a.updatedTime).format("YYYY-MM-DD HH:mm:ss")),1)])),_:1},8,["label"])])),_:1},8,["data"]),p("div",B,[g($).loading&&g(q)?(d(),c("span",L,b(g(H)("loading")),1)):z("",!0)])],8,M)),[[i,W]])}}});export{T as default};
